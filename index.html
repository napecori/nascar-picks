<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NASCAR Picks League</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Special+Elite&family=Barlow+Condensed:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #0a0a0a;
    --cream: #f5f0e8;
    --red: #c8102e;
    --gold: #d4a017;
    --dark-gold: #a07810;
    --gray: #2a2a2a;
    --mid-gray: #444;
    --light-gray: #888;
    --checkered: repeating-conic-gradient(#0a0a0a 0% 25%, #f5f0e8 0% 50%) 0 0 / 20px 20px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background-color: var(--black);
    color: var(--cream);
    font-family: 'Barlow Condensed', sans-serif;
    min-height: 100vh;
  }

  /* HEADER */
  .site-header {
    background: var(--black);
    border-bottom: 6px solid var(--red);
    position: relative;
    overflow: hidden;
  }
  .header-checkered {
    height: 18px;
    background: var(--checkered);
    opacity: 0.6;
  }
  .header-inner {
    padding: 24px 40px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
  }
  .site-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 4rem;
    letter-spacing: 4px;
    color: var(--cream);
    line-height: 1;
    text-shadow: 4px 4px 0 var(--red);
  }
  .site-title span { color: var(--gold); }
  .header-badge {
    background: var(--red);
    color: var(--cream);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
    padding: 6px 16px;
    border: 2px solid var(--gold);
    text-align: center;
    line-height: 1.4;
  }
  .season-label {
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    color: var(--gold);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  /* NAV TABS */
  .nav-tabs {
    display: flex;
    background: var(--gray);
    border-bottom: 3px solid var(--red);
    padding: 0 40px;
    gap: 0;
  }
  .nav-tab {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
    padding: 14px 28px;
    cursor: pointer;
    border: none;
    background: none;
    color: var(--light-gray);
    border-bottom: 4px solid transparent;
    margin-bottom: -3px;
    transition: all 0.2s;
    position: relative;
  }
  .nav-tab:hover { color: var(--cream); }
  .nav-tab.active {
    color: var(--gold);
    border-bottom: 4px solid var(--gold);
    background: var(--black);
  }

  /* MAIN CONTENT */
  .main { padding: 32px 40px; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* ===== STANDINGS TAB ===== */
  .standings-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 36px;
  }
  .player-card {
    background: var(--gray);
    border: 2px solid var(--mid-gray);
    border-top: 5px solid var(--red);
    padding: 20px;
    position: relative;
    transition: border-color 0.2s;
  }
  .player-card:hover { border-color: var(--gold); }
  .player-card.rank-1 { border-top-color: var(--gold); }
  .player-card.rank-2 { border-top-color: #aaa; }
  .player-card.rank-3 { border-top-color: #cd7f32; }
  .rank-badge {
    position: absolute;
    top: -14px;
    left: 16px;
    background: var(--red);
    color: var(--cream);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    padding: 2px 10px;
    letter-spacing: 1px;
  }
  .player-card.rank-1 .rank-badge { background: var(--gold); color: var(--black); }
  .player-card.rank-2 .rank-badge { background: #888; }
  .player-card.rank-3 .rank-badge { background: #cd7f32; }
  .player-name {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 2px;
    margin-top: 8px;
    color: var(--cream);
  }
  .player-pts {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 3rem;
    color: var(--gold);
    line-height: 1;
  }
  .player-pts-label {
    font-size: 0.75rem;
    letter-spacing: 3px;
    color: var(--light-gray);
    text-transform: uppercase;
    margin-bottom: 2px;
  }
  .player-races {
    font-size: 0.85rem;
    color: var(--light-gray);
    margin-top: 8px;
    border-top: 1px solid var(--mid-gray);
    padding-top: 8px;
  }
  .player-races span { color: var(--cream); font-weight: 600; }

  /* Standings Table */
  .section-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 3px;
    color: var(--gold);
    border-left: 5px solid var(--red);
    padding-left: 12px;
    margin-bottom: 16px;
  }
  .standings-table-wrap { overflow-x: auto; margin-bottom: 40px; }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }
  thead tr {
    background: var(--red);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 1.5px;
  }
  thead th {
    padding: 10px 14px;
    text-align: left;
    color: var(--cream);
    white-space: nowrap;
  }
  thead th.center { text-align: center; }
  tbody tr { border-bottom: 1px solid var(--mid-gray); transition: background 0.15s; }
  tbody tr:hover { background: rgba(212,160,23,0.08); }
  tbody tr:nth-child(even) { background: rgba(255,255,255,0.03); }
  tbody tr:nth-child(even):hover { background: rgba(212,160,23,0.08); }
  tbody td {
    padding: 9px 14px;
    color: var(--cream);
    white-space: nowrap;
  }
  tbody td.center { text-align: center; }
  tbody td.pts { color: var(--gold); font-weight: 700; font-size: 1.05rem; }
  tbody td.dim { color: var(--light-gray); font-size: 0.85rem; }
  .discipline-badge {
    display: inline-block;
    padding: 2px 8px;
    font-size: 0.75rem;
    letter-spacing: 1px;
    font-weight: 700;
    text-transform: uppercase;
    border-radius: 2px;
  }
  .disc-superspeedway { background: #1a3a6e; color: #7ab3ff; }
  .disc-speedway { background: #3a1a00; color: #ffa040; }
  .disc-road { background: #1a3a1a; color: #7aff7a; }
  .disc-short { background: #3a1a3a; color: #ff80ff; }

  /* ===== PICKS TAB ===== */
  .player-tabs {
    display: flex;
    gap: 0;
    margin-bottom: 0;
    border-bottom: 2px solid var(--mid-gray);
  }
  .player-tab {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 2px;
    padding: 10px 24px;
    cursor: pointer;
    background: var(--gray);
    border: none;
    color: var(--light-gray);
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: all 0.15s;
  }
  .player-tab.active { color: var(--gold); border-bottom-color: var(--gold); background: var(--black); }
  .player-tab:hover:not(.active) { color: var(--cream); }

  .picks-table-wrap { overflow-x: auto; margin-top: 0; }
  .picks-content { display: none; }
  .picks-content.active { display: block; }

  .picks-table thead tr { background: #1a1a1a; }
  .picks-table thead th { border-right: 1px solid var(--mid-gray); }
  .picks-table thead th:last-child { border-right: none; }
  .picks-table .group-header {
    background: var(--red);
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 1.5px;
    text-align: center;
    font-size: 0.9rem;
  }
  .picks-table .subheader {
    background: #1c1c1c;
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 1px;
    color: var(--light-gray);
    text-transform: uppercase;
  }
  .edit-cell {
    background: rgba(255,255,255,0.03);
  }
  .edit-cell input, .edit-cell select {
    background: transparent;
    border: none;
    border-bottom: 1px dashed var(--mid-gray);
    color: var(--cream);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.92rem;
    width: 100%;
    padding: 2px 4px;
    outline: none;
    min-width: 80px;
  }
  .edit-cell input:focus, .edit-cell select:focus {
    border-bottom-color: var(--gold);
    background: rgba(212,160,23,0.05);
  }
  .edit-cell select option { background: var(--gray); color: var(--cream); }
  .week-num { color: var(--light-gray); font-size: 0.85rem; text-align: center; }
  .total-row td { background: #1a1a1a !important; font-weight: 700; border-top: 2px solid var(--gold); }
  .total-row .pts { font-size: 1.15rem; }

  /* ===== POINTS REF TAB ===== */
  .points-ref-grid {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 32px;
  }
  .points-table-small { max-width: 300px; }
  .points-table-small table { font-size: 0.88rem; }
  .points-table-small thead tr { background: var(--red); }

  /* Schedule */
  .schedule-section { flex: 1; }
  .schedule-table tbody td { font-size: 0.88rem; }

  /* Footer checkered */
  .footer-checkered {
    height: 18px;
    background: var(--checkered);
    opacity: 0.4;
    margin-top: 60px;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .main { padding: 20px 16px; }
    .header-inner { padding: 16px; flex-direction: column; align-items: flex-start; }
    .site-title { font-size: 2.8rem; }
    .standings-grid { grid-template-columns: 1fr 1fr; }
    .points-ref-grid { grid-template-columns: 1fr; }
    .nav-tabs { padding: 0 16px; }
  }
</style>
</head>
<body>

<header class="site-header">
  <div class="header-checkered"></div>
  <div class="header-inner">
    <div>
      <div class="site-title">üèÅ <span>Thunder</span> Picks</div>
      <div class="season-label">NASCAR Fantasy League &mdash; 2025 Season</div>
    </div>
    <div class="header-badge">35 RACES<br>4 PLAYERS<br>3 PICKS/WEEK</div>
  </div>
</header>

<nav class="nav-tabs">
  <button class="nav-tab active" onclick="switchTab('standings')">üèÜ Standings</button>
  <button class="nav-tab" onclick="switchTab('picks')">üìã Weekly Picks</button>
  <button class="nav-tab" onclick="switchTab('schedule')">üìÖ Schedule</button>
  <button class="nav-tab" onclick="switchTab('pointsref')">üìä Points Reference</button>
</nav>

<main class="main">

  <!-- ===== STANDINGS ===== -->
  <div id="tab-standings" class="tab-content active">
    <div id="standings-cards" class="standings-grid"></div>
    <div class="section-title">Full Season Results</div>
    <div class="standings-table-wrap">
      <table id="standings-full-table">
        <thead>
          <tr>
            <th>Race</th>
            <th>Track</th>
            <th>Discipline</th>
            <th class="center" colspan="3">Player 1</th>
            <th class="center" colspan="3">Player 2</th>
            <th class="center" colspan="3">Player 3</th>
            <th class="center" colspan="3">Player 4</th>
          </tr>
          <tr class="subheader" style="background:#1c1c1c;font-family:'Oswald',sans-serif;font-size:0.75rem;color:#888;">
            <th></th><th></th><th></th>
            <th class="center">Picks</th><th class="center">Pts</th><th class="center">Cumul.</th>
            <th class="center">Picks</th><th class="center">Pts</th><th class="center">Cumul.</th>
            <th class="center">Picks</th><th class="center">Pts</th><th class="center">Cumul.</th>
            <th class="center">Picks</th><th class="center">Pts</th><th class="center">Cumul.</th>
          </tr>
        </thead>
        <tbody id="standings-full-body"></tbody>
      </table>
    </div>
  </div>

  <!-- ===== PICKS ===== -->
  <div id="tab-picks" class="tab-content">
    <div class="player-tabs" id="player-tabs"></div>
    <div id="picks-panels"></div>
  </div>

  <!-- ===== SCHEDULE ===== -->
  <div id="tab-schedule" class="tab-content">
    <div class="section-title">2025 Race Schedule</div>
    <div class="standings-table-wrap">
      <table id="schedule-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Track</th>
            <th>Discipline</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="schedule-body"></tbody>
      </table>
    </div>
  </div>

  <!-- ===== POINTS REF ===== -->
  <div id="tab-pointsref" class="tab-content">
    <div class="points-ref-grid">
      <div>
        <div class="section-title">Points Table</div>
        <div class="standings-table-wrap">
          <table>
            <thead><tr><th>Finish Position</th><th class="center">Points</th></tr></thead>
            <tbody id="points-ref-body"></tbody>
          </table>
        </div>
      </div>
      <div>
        <div class="section-title">How It Works</div>
        <div style="font-family:'Special Elite',serif;color:#bbb;line-height:1.9;font-size:1rem;max-width:480px;background:var(--gray);padding:24px;border-left:4px solid var(--gold);">
          <p>Each week, every player picks <strong style="color:var(--gold);">3 drivers</strong> before the race.</p><br>
          <p>After the race, each driver's finish position maps to points using the table on the left.</p><br>
          <p>A player's <strong style="color:var(--gold);">weekly score</strong> is the sum of all three drivers' points.</p><br>
          <p><strong style="color:var(--gold);">Cumulative points</strong> track the running total across all 35 races.</p><br>
          <p>The player with the most cumulative points at the end of <strong style="color:var(--gold);">Race 35</strong> wins the season.</p>
        </div>
        <div style="margin-top:24px;">
          <div class="section-title">Discipline Key</div>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
            <div><span class="discipline-badge disc-superspeedway">Superspeedway</span> <span style="color:#888;font-size:0.85rem;margin-left:8px;">Daytona, Talladega</span></div>
            <div><span class="discipline-badge disc-speedway">Speedway</span> <span style="color:#888;font-size:0.85rem;margin-left:8px;">Las Vegas, Michigan, etc.</span></div>
            <div><span class="discipline-badge disc-road">Road Course</span> <span style="color:#888;font-size:0.85rem;margin-left:8px;">COTA, Sonoma, Watkins Glen</span></div>
            <div><span class="discipline-badge disc-short">Short Track</span> <span style="color:#888;font-size:0.85rem;margin-left:8px;">Bristol, Martinsville, Richmond</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</main>
<div class="footer-checkered"></div>

<script>
// ============================================================
// DATA
// ============================================================

const POINTS_TABLE = {
  1:40,2:35,3:34,4:33,5:32,6:31,7:30,8:29,9:28,10:27,
  11:26,12:25,13:24,14:23,15:22,16:21,17:20,18:19,19:18,20:17,
  21:16,22:15,23:14,24:13,25:12,26:11,27:10,28:9,29:8,30:7,
  31:6,32:5,33:4,34:3,35:2,36:1,37:1,38:1,39:1,40:1
};

const PLAYER_NAMES = ['Player 1','Player 2','Player 3','Player 4'];

const SCHEDULE = [
  {race:1,  track:'Daytona International Speedway',      disc:'superspeedway', date:'Feb 16'},
  {race:2,  track:'Atlanta Motor Speedway',              disc:'superspeedway', date:'Feb 23'},
  {race:3,  track:'Las Vegas Motor Speedway',            disc:'speedway',      date:'Mar 2'},
  {race:4,  track:'Phoenix Raceway',                     disc:'short',         date:'Mar 9'},
  {race:5,  track:'Circuit of the Americas',             disc:'road',          date:'Mar 23'},
  {race:6,  track:'Martinsville Speedway',               disc:'short',         date:'Mar 30'},
  {race:7,  track:'Texas Motor Speedway',                disc:'speedway',      date:'Apr 6'},
  {race:8,  track:'Bristol Motor Speedway (Dirt)',       disc:'short',         date:'Apr 13'},
  {race:9,  track:'Talladega Superspeedway',             disc:'superspeedway', date:'Apr 27'},
  {race:10, track:'Dover Motor Speedway',                disc:'short',         date:'May 4'},
  {race:11, track:'Kansas Speedway',                     disc:'speedway',      date:'May 11'},
  {race:12, track:'Darlington Raceway',                  disc:'speedway',      date:'May 18'},
  {race:13, track:'Charlotte Motor Speedway',            disc:'speedway',      date:'May 25'},
  {race:14, track:'Gateway Motorsports Park',            disc:'short',         date:'Jun 1'},
  {race:15, track:'Sonoma Raceway',                      disc:'road',          date:'Jun 8'},
  {race:16, track:'Iowa Speedway',                       disc:'short',         date:'Jun 15'},
  {race:17, track:'New Hampshire Motor Speedway',        disc:'short',         date:'Jun 22'},
  {race:18, track:'Nashville Superspeedway',             disc:'speedway',      date:'Jun 29'},
  {race:19, track:'Chicago Street Course',               disc:'road',          date:'Jul 6'},
  {race:20, track:'Pocono Raceway',                      disc:'speedway',      date:'Jul 13'},
  {race:21, track:'Indianapolis Motor Speedway Road',    disc:'road',          date:'Jul 20'},
  {race:22, track:'Michigan International Speedway',     disc:'speedway',      date:'Jul 27'},
  {race:23, track:'Richmond Raceway',                    disc:'short',         date:'Aug 10'},
  {race:24, track:'Watkins Glen International',          disc:'road',          date:'Aug 17'},
  {race:25, track:'Daytona International Speedway',      disc:'superspeedway', date:'Aug 24'},
  {race:26, track:'Darlington Raceway',                  disc:'speedway',      date:'Aug 31'},
  {race:27, track:'Atlanta Motor Speedway',              disc:'superspeedway', date:'Sep 7'},
  {race:28, track:'Pocono Raceway',                      disc:'speedway',      date:'Sep 14'},
  {race:29, track:'Bristol Motor Speedway',              disc:'short',         date:'Sep 21'},
  {race:30, track:'Texas Motor Speedway',                disc:'speedway',      date:'Sep 28'},
  {race:31, track:'Talladega Superspeedway',             disc:'superspeedway', date:'Oct 5'},
  {race:32, track:'Charlotte Motor Speedway (ROVAL)',    disc:'road',          date:'Oct 12'},
  {race:33, track:'Las Vegas Motor Speedway',            disc:'speedway',      date:'Oct 19'},
  {race:34, track:'Martinsville Speedway',               disc:'short',         date:'Oct 26'},
  {race:35, track:'Phoenix Raceway',                     disc:'short',         date:'Nov 2'},
];

const DISC_LABELS = {
  superspeedway:'Superspeedway', speedway:'Speedway', road:'Road Course', short:'Short Track'
};
const DISC_CLASS = {
  superspeedway:'disc-superspeedway', speedway:'disc-speedway', road:'disc-road', short:'disc-short'
};

// ============================================================
// STATE ‚Äî stored in localStorage keyed by "nascar_picks_v1"
// ============================================================
// Structure: picks[playerIdx][raceIdx] = {
//   d1name, d1fin, d2name, d2fin, d3name, d3fin
// }

const STORAGE_KEY = 'nascar_picks_v1';
let picks = loadPicks();

function loadPicks() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) return JSON.parse(raw);
  } catch(e){}
  // Initialize empty
  const p = [];
  for(let i=0;i<4;i++){
    p.push(Array.from({length:35}, ()=>({d1name:'',d1fin:'',d2name:'',d2fin:'',d3name:'',d3fin:''})));
  }
  return p;
}

function savePicks() {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(picks)); } catch(e){}
}

// ============================================================
// POINTS CALCULATION
// ============================================================

function finPts(fin) {
  const n = parseInt(fin);
  if (!n || n < 1) return 0;
  if (n > 40) return 1;
  return POINTS_TABLE[n] || 1;
}

function weekScore(p, race) {
  const d = picks[p][race];
  return finPts(d.d1fin) + finPts(d.d2fin) + finPts(d.d3fin);
}

function cumulScore(p, upToRace) {
  let total = 0;
  for (let r=0; r<=upToRace; r++) total += weekScore(p, r);
  return total;
}

function playerTotals() {
  return PLAYER_NAMES.map((name,i)=>({name, total: cumulScore(i, 34)}))
    .sort((a,b)=>b.total-a.total);
}

// ============================================================
// TAB SWITCHING
// ============================================================

function switchTab(name) {
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  event.currentTarget.classList.add('active');
  if(name==='standings') renderStandings();
}

// ============================================================
// RENDER STANDINGS
// ============================================================

function renderStandings() {
  // Cards
  const sorted = playerTotals();
  const cardsEl = document.getElementById('standings-cards');
  cardsEl.innerHTML = '';
  sorted.forEach((player, idx) => {
    const rank = idx+1;
    const playerIdx = PLAYER_NAMES.indexOf(player.name);
    const racesScored = picks[playerIdx].filter(r=>r.d1fin||r.d2fin||r.d3fin).length;
    cardsEl.innerHTML += `
      <div class="player-card rank-${rank}">
        <div class="rank-badge">#${rank}</div>
        <div class="player-name">${player.name}</div>
        <div class="player-pts-label">Total Points</div>
        <div class="player-pts">${player.total}</div>
        <div class="player-races">Races entered: <span>${racesScored}</span> / 35</div>
      </div>`;
  });

  // Full table
  const tbody = document.getElementById('standings-full-body');
  tbody.innerHTML = '';
  SCHEDULE.forEach((race, ri) => {
    const cumuls = PLAYER_NAMES.map((_,pi) => cumulScore(pi, ri));
    const weekPts = PLAYER_NAMES.map((_,pi) => weekScore(pi, ri));
    const row = document.createElement('tr');
    let pCells = '';
    PLAYER_NAMES.forEach((_,pi) => {
      const d = picks[pi][ri];
      const pickStr = [d.d1name,d.d2name,d.d3name].filter(Boolean).join(', ') || '‚Äî';
      pCells += `<td class="center dim">${pickStr}</td>
                 <td class="center pts">${weekPts[pi]||'‚Äî'}</td>
                 <td class="center" style="color:#ccc">${cumuls[pi]||'‚Äî'}</td>`;
    });
    row.innerHTML = `
      <td class="week-num">${race.race}</td>
      <td>${race.track}</td>
      <td><span class="discipline-badge ${DISC_CLASS[race.disc]}">${DISC_LABELS[race.disc]}</span></td>
      ${pCells}`;
    tbody.appendChild(row);
  });
}

// ============================================================
// RENDER PICKS PANELS
// ============================================================

function renderPicksPanels() {
  const tabsEl = document.getElementById('player-tabs');
  const panelsEl = document.getElementById('picks-panels');
  tabsEl.innerHTML = '';
  panelsEl.innerHTML = '';

  PLAYER_NAMES.forEach((name, pi) => {
    // Tab button
    const btn = document.createElement('button');
    btn.className = 'player-tab' + (pi===0?' active':'');
    btn.textContent = name;
    btn.onclick = () => {
      document.querySelectorAll('.player-tab').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.picks-content').forEach(p=>p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('picks-panel-'+pi).classList.add('active');
    };
    tabsEl.appendChild(btn);

    // Panel
    const panel = document.createElement('div');
    panel.className = 'picks-content' + (pi===0?' active':'');
    panel.id = 'picks-panel-'+pi;

    let rows = '';
    let totalWk = 0;
    SCHEDULE.forEach((race, ri) => {
      const d = picks[pi][ri];
      const wp = weekScore(pi, ri);
      const cumul = cumulScore(pi, ri);
      if(wp) totalWk += wp;
      rows += `<tr>
        <td class="week-num">${race.race}</td>
        <td style="font-size:0.85rem">${race.track}</td>
        <td><span class="discipline-badge ${DISC_CLASS[race.disc]}">${DISC_LABELS[race.disc].substring(0,4)}</span></td>
        <td class="edit-cell"><input type="text" value="${d.d1name}" placeholder="Driver name" onchange="updatePick(${pi},${ri},'d1name',this.value)"></td>
        <td class="edit-cell"><input type="number" value="${d.d1fin}" placeholder="Pos" min="1" max="43" style="width:54px" onchange="updatePick(${pi},${ri},'d1fin',this.value)"></td>
        <td class="center pts" id="p${pi}r${ri}d1pts">${d.d1fin?finPts(d.d1fin):''}</td>
        <td class="edit-cell"><input type="text" value="${d.d2name}" placeholder="Driver name" onchange="updatePick(${pi},${ri},'d2name',this.value)"></td>
        <td class="edit-cell"><input type="number" value="${d.d2fin}" placeholder="Pos" min="1" max="43" style="width:54px" onchange="updatePick(${pi},${ri},'d2fin',this.value)"></td>
        <td class="center pts" id="p${pi}r${ri}d2pts">${d.d2fin?finPts(d.d2fin):''}</td>
        <td class="edit-cell"><input type="text" value="${d.d3name}" placeholder="Driver name" onchange="updatePick(${pi},${ri},'d3name',this.value)"></td>
        <td class="edit-cell"><input type="number" value="${d.d3fin}" placeholder="Pos" min="1" max="43" style="width:54px" onchange="updatePick(${pi},${ri},'d3fin',this.value)"></td>
        <td class="center pts" id="p${pi}r${ri}d3pts">${d.d3fin?finPts(d.d3fin):''}</td>
        <td class="center pts" id="p${pi}r${ri}wk" style="font-size:1.05rem;color:var(--gold)">${wp||''}</td>
        <td class="center" id="p${pi}r${ri}cu" style="color:#ccc">${cumul||''}</td>
      </tr>`;
    });
    rows += `<tr class="total-row">
      <td colspan="3" style="text-align:right;color:var(--gold);font-family:'Bebas Neue',sans-serif;letter-spacing:2px;">SEASON TOTAL</td>
      <td colspan="9"></td>
      <td class="center pts" style="font-size:1.2rem">${totalWk||'‚Äî'}</td>
      <td></td>
    </tr>`;

    panel.innerHTML = `
      <div class="picks-table-wrap">
        <table class="picks-table" style="min-width:900px">
          <thead>
            <tr>
              <th rowspan="2" class="center">#</th>
              <th rowspan="2">Track</th>
              <th rowspan="2">Type</th>
              <th colspan="3" class="group-header center">Driver 1</th>
              <th colspan="3" class="group-header center">Driver 2</th>
              <th colspan="3" class="group-header center">Driver 3</th>
              <th rowspan="2" class="center" style="background:var(--dark-gold);color:var(--cream)">Week<br>Pts</th>
              <th rowspan="2" class="center" style="background:#1a1a1a">Cumul.</th>
            </tr>
            <tr class="subheader">
              <th>Name</th><th class="center">Fin</th><th class="center">Pts</th>
              <th>Name</th><th class="center">Fin</th><th class="center">Pts</th>
              <th>Name</th><th class="center">Fin</th><th class="center">Pts</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      </div>`;
    panelsEl.appendChild(panel);
  });
}

// ============================================================
// UPDATE PICK
// ============================================================

function updatePick(pi, ri, field, value) {
  picks[pi][ri][field] = value;
  savePicks();
  // Refresh pts cells
  const d = picks[pi][ri];
  ['d1','d2','d3'].forEach(dx => {
    const el = document.getElementById(`p${pi}r${ri}${dx}pts`);
    if(el) el.textContent = picks[pi][ri][dx+'fin'] ? finPts(picks[pi][ri][dx+'fin']) : '';
  });
  const wkEl = document.getElementById(`p${pi}r${ri}wk`);
  const cuEl = document.getElementById(`p${pi}r${ri}cu`);
  const wp = weekScore(pi, ri);
  if(wkEl) wkEl.textContent = wp || '';
  if(cuEl) cuEl.textContent = cumulScore(pi, ri) || '';
  // Update cumulative cells below
  for(let r=ri; r<35; r++){
    const c = document.getElementById(`p${pi}r${r}cu`);
    if(c) c.textContent = cumulScore(pi, r) || '';
    const w = document.getElementById(`p${pi}r${r}wk`);
    if(w) w.textContent = weekScore(pi, r) || '';
  }
}

// ============================================================
// RENDER SCHEDULE
// ============================================================

function renderSchedule() {
  const tbody = document.getElementById('schedule-body');
  SCHEDULE.forEach(race => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="week-num">${race.race}</td>
      <td>${race.track}</td>
      <td><span class="discipline-badge ${DISC_CLASS[race.disc]}">${DISC_LABELS[race.disc]}</span></td>
      <td class="dim">2025, ${race.date}</td>`;
    tbody.appendChild(tr);
  });
}

// ============================================================
// RENDER POINTS REFERENCE
// ============================================================

function renderPointsRef() {
  const tbody = document.getElementById('points-ref-body');
  for(let pos=1; pos<=40; pos++){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${pos}${pos<=3?['st','nd','rd'][pos-1]:'th'}</td><td class="center pts">${POINTS_TABLE[pos]}</td>`;
    tbody.appendChild(tr);
  }
}

// ============================================================
// INIT
// ============================================================

renderStandings();
renderPicksPanels();
renderSchedule();
renderPointsRef();
</script>
</body>
</html>
